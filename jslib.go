package gotalk

const JSLibSHA1Base64 = "GyniSDXDYZpPorhsx6InxF9Ab20="
const JSLibString = "var gotalk=(function(){var I=Object.defineProperty,ge=Object.prototype.hasOwnProperty,q=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),Z=e=>I(e,\"__esModule\",{value:!0}),$=(e,t)=>{Z(e);for(var r in t)I(e,r,{get:t[r],enumerable:!0})},he=(e,t)=>{if(Z(e),typeof t==\"object\"||typeof t==\"function\")for(var r in t)!ge.call(e,r)&&r!==\"default\"&&(n=>{I(e,n,{get:()=>t[n],enumerable:!0})})(r);return e},w=e=>e&&e.__esModule?e:he(I({},\"default\",{value:e,enumerable:!0}),e);var P=q(_=>{$(_,{sizeOf:()=>ee});function ee(e){for(var t=0,r=0,n;n=e.charCodeAt(r++);t+=n>>11?3:n>>7?2:1);return t}function B(e){return 255&e}if(typeof TextDecoder!=\"undefined\"){var me=new TextDecoder(\"utf8\"),ve=new TextEncoder(\"utf8\");_.decode=function(t){return me.decode(t)},_.encode=function(t){return ve.encode(t)}}else _.decode=function(t){var r=0,n=t.length-r,o,s,i=\"\";for(r=0;r<n;)o=t[r++],s=B(o),s<128||(s>>5==6?o=(o<<6&2047)+(t[r++]&63):s>>4==14?(o=(o<<12&65535)+(B(t[r++])<<6&4095),o+=t[r++]&63):s>>3==30&&(o=(o<<18&2097151)+(B(t[r++])<<12&262143),o+=B(t[r++])<<6&4095,o+=t[r++]&63)),i+=String.fromCharCode(o);return i},_.encode=function(t){for(var r=0,n=t.length,o,s=0,i=new Uint8Array(ee(t));r!==n;)o=t.charCodeAt(r++),o<128?i[s++]=o:o<2048?(i[s++]=o>>6|192,i[s++]=o&63|128):o<65536?(i[s++]=o>>12|224,i[s++]=o>>6&63|128,i[s++]=o&63|128):(i[s++]=o>>18|240,i[s++]=o>>12&63|128,i[s++]=o>>6&63|128,i[s++]=o&63|128);return i}});var V=q(A=>{function D(){}A.global=typeof global!=\"undefined\"?global:typeof self!=\"undefined\"?self:typeof window!=\"undefined\"?window:A;A.console=typeof console!=\"undefined\"?console:{log:D,warn:D,error:D};A.document=typeof document!=\"undefined\"?document:null});var j=q(d=>{const k=w(P());d.Version=1;var te=d.MsgTypeSingleReq=114,re=d.MsgTypeStreamReq=115,Ce=d.MsgTypeStreamReqPart=112,He=d.MsgTypeSingleRes=82,Oe=d.MsgTypeStreamRes=83,Ie=d.MsgTypeErrorRes=69,z=d.MsgTypeRetryRes=101,N=d.MsgTypeNotification=110,U=d.MsgTypeHeartbeat=104,ne=d.MsgTypeProtocolError=102;d.ErrorAbnormal=0;d.ErrorUnsupported=1;d.ErrorInvalidMsg=2;d.ErrorTimeout=3;d.HeartbeatMsgMaxLoad=65535;function T(e,t,r,n){for(var o=t||0,s=0,i,a=r.toString(16),m=n-a.length;m--;)e[o++]=48;for(;!isNaN(i=a.charCodeAt(s++));)e[o++]=i}function oe(e,t){var r=g(t);return T(r,0,e,t),r}function C(e){for(var t=0,r=0,n=0,o=!1;r<e.length;r++)n=e[r],n<64?(n<48&&(o=!0),n-=48):n<71?(n<65&&(o=!0),n-=55):n<103&&96<n?n-=87:o=!0,t=t<<4|n&15;if(o)throw new Error(\"invalid hexint \"+String.fromCharCode.apply(null,e));return t}d.binary={makeFixnum:oe,versionBuf:oe(d.Version,2),parseVersion:C,parseMsg:function(e){var t,r,n,o,s=0,i=0,a;return t=e[0],a=1,t===U?(s=C(e.subarray(a,a+4)),a+=4):t!==N&&t!==ne&&(r=e.subarray(a,a+4),a+=4),t==te||t==re||t==N?(o=C(e.subarray(a,a+3)),a+=3,n=k.decode(e.subarray(a,a+o)),a+=o):t===z&&(s=C(e.subarray(a,a+8)),a+=8),i=C(e.subarray(a,a+8)),{t:t,id:r,name:n,wait:s,size:i}},makeMsg:function(e,t,r,n,o){var s,i,a=t?13:9;return r&&r.length!==0&&(i=k.encode(r),a+=3+i.length),s=g(a),s[0]=e,a=1,t&&t.length===4&&(typeof t==\"string\"?(s[1]=t.charCodeAt(0),s[2]=t.charCodeAt(1),s[3]=t.charCodeAt(2),s[4]=t.charCodeAt(3)):(s[1]=t[0],s[2]=t[1],s[3]=t[2],s[4]=t[3]),a+=4),i&&(T(s,a,i.length,3),a+=3,s.set(i,a),a+=i.length),e===z&&(T(s,a,n,8),a+=8),T(s,a,o,8),s},makeHeartbeatMsg:function(e){var t=g(13),r=1;return t[0]=U,T(t,r,e,4),r+=4,T(t,r,Math.round(new Date().getTime()/1e3),8),r+=8,t}};var be=\"00000000\";function x(e,t){var r=e.toString(16);return be.substr(0,t-r.length)+r}d.text={makeFixnum:x,versionBuf:x(d.Version,2),parseVersion:function(e){return parseInt(e.substr(0,2),16)},parseMsg:function(e){var t,r,n,o=0,s=0,i;return t=e.charCodeAt(0),i=1,t===U?(o=parseInt(e.substr(i,4),16),i+=4):t!==N&&t!==ne&&(r=e.substr(i,4),i+=4),t==te||t==re||t==N?n=e.substring(i+3,e.length-8):t==z&&(o=parseInt(e.substr(i,8),16),i+=8),s=parseInt(e.substr(e.length-8),16),{t:t,id:r,name:n,wait:o,size:s}},makeMsg:function(e,t,r,n,o){var s=String.fromCharCode(e);return t&&t.length===4&&(s+=t),r&&r.length!==0&&(s+=x(k.sizeOf(r),3),s+=r),e===z&&(s+=x(n,8)),s+=x(o,8),s},makeHeartbeatMsg:function(e){var t=String.fromCharCode(U);return t+=x(e,4),t+=x(Math.round(new Date().getTime()/1e3),8),t}}});var ce=q(v=>{$(v,{default:()=>ie});const R=w(V()),l=w(j()),H=w(P());var u=v,ie=v,ae=l.text,le=l.binary;u.version=\"1.1.5\";u.protocol=l;u.Buf=g;u.developmentMode=!1;u.defaultResponderAddress=\"\";var fe=\"\",c={wsproto:\"\",proto:\"\",host:\"\",path:\"\"};function xe(){R.document&&ye(),u.developmentMode=we(c.host)}function ye(){var e=R.document.currentScript.src;if(!e)return;var t=e.indexOf(\"://\")+3;if(t==2)return;c.proto=e.substr(0,t-2);var r=e.indexOf(\"/\",t);if(r==-1)return;c.wsproto=c.proto==\"https:\"?\"wss://\":\"ws://\",c.host=e.substring(t,r),e=e.substr(r),t=e.lastIndexOf(\"?\"),t!=-1&&(e=e.substr(0,t)),c.path=e.substring(e.indexOf(\"/\"),e.lastIndexOf(\"/\")+1),u.defaultResponderAddress=c.wsproto+c.host+c.path,fe=u.defaultResponderAddress}function we(e){var t=e,r=t.lastIndexOf(\":\");return r!=-1&&(t=t.substr(0,r)),r=t.lastIndexOf(\".\"),r==-1?t==\"localhost\":t==\"127.0.0.1\"||t.substr(r)==\".local\"}function L(){u.developmentMode&&R.console.warn.apply(R.console,Array.prototype.slice.call(arguments))}function J(e){if(!e||e.length==0)return null;typeof e!=\"string\"&&(e=H.decode(e));try{return JSON.parse(e)}catch(t){L(\"[gotalk] ignoring invalid json\",e)}}function f(e,t){return Object.create(f.prototype,{handlers:{value:e,enumerable:!0},protocol:{value:t||(g?l.binary:l.text),enumerable:!0,writable:!0},heartbeatInterval:{value:20*1e3,enumerable:!0,writable:!0},ws:{value:null,writable:!0},keepalive:{value:null,writable:!0},nextOpID:{value:0,writable:!0},nextStreamID:{value:0,writable:!0},pendingRes:{value:{},writable:!0},hasPendingRes:{get:function(){for(var r in this.pendingRes)return!0}},pendingClose:{value:!1,writable:!0}})}f.prototype=p.mixin(f.prototype);v.Sock=f;function Me(e,t){if(e.pendingClose=!1,e.stopSendingHeartbeats(),e.ws&&(e.ws.onmessage=null,e.ws.onerror=null,e.ws.onclose=null,e.ws=null),e.nextOpID=0,e.hasPendingRes){var r=t||new Error(\"connection closed\");for(var n in e.pendingRes)e.pendingRes[n](r);e.pendingRes={}}}var Ee={1e3:\"normal\",1001:\"going away\",1002:\"protocol error\",1003:\"unsupported\",1005:\"no status\",1006:\"abnormal\",1007:\"inconsistent\",1008:\"invalid message\",1009:\"too large\"},M=Symbol(\"CLOSE_ERROR\");function G(e){var t=Ee[e];return\"#\"+e+(t?\" (\"+t+\")\":\"\")}f.prototype.adoptWebSocket=function(e){var t=this;if(e.readyState!==WebSocket.OPEN)throw new Error(\"web socket readyState != OPEN\");e.binaryType=\"arraybuffer\",t.ws=e,e.onclose=function(r){var n=e[M]||null;!n&&r.code!==1e3&&(n=new Error(\"websocket closed: \"+G(r.code))),Me(t,n),t.emit(\"close\",n)},e.onmessage=function(r){e._bufferedMessages||(e._bufferedMessages=[]),e._bufferedMessages.push(r.data)}};f.prototype.adopt=function(e){if(adopt instanceof WebSocket)return this.adoptWebSocket(e);throw new Error(\"unsupported transport\")};f.prototype.handshake=function(){this.ws.send(this.protocol.versionBuf)};f.prototype.end=function(){var e=this;e.keepalive&&(e.keepalive.disable(),e.keepalive=null),!e.pendingClose&&e.hasPendingRes?e.pendingClose=!0:e.ws&&e.ws.close(1e3)};f.prototype.address=function(){var e=this;return e.ws?e.ws.url:null};var K=v.ErrAbnormal=Error(\"unsupported protocol\");K.isGotalkProtocolError=!0;K.code=l.ErrorAbnormal;var F=v.ErrUnsupported=Error(\"unsupported protocol\");F.isGotalkProtocolError=!0;F.code=l.ErrorUnsupported;var W=v.ErrInvalidMsg=Error(\"invalid protocol message\");W.isGotalkProtocolError=!0;W.code=l.ErrorInvalidMsg;var X=v.ErrTimeout=Error(\"timeout\");X.isGotalkProtocolError=!0;X.code=l.ErrorTimeout;f.prototype.sendHeartbeat=function(e){var t=this,r=t.protocol.makeHeartbeatMsg(Math.round(e*l.HeartbeatMsgMaxLoad));try{t.ws.send(r)}catch(n){throw(!this.ws||this.ws.readyState>WebSocket.OPEN)&&(n=new Error(\"socket is closed\")),n}};f.prototype.startSendingHeartbeats=function(){var e=this;if(e.heartbeatInterval<10)throw new Error(\"Sock.heartbeatInterval is too low\");clearTimeout(e._sendHeartbeatsTimer);var t=function(){clearTimeout(e._sendHeartbeatsTimer),e.sendHeartbeat(0),e._sendHeartbeatsTimer=setTimeout(t,e.heartbeatInterval)};e._sendHeartbeatsTimer=setTimeout(t,1)};f.prototype.stopSendingHeartbeats=function(){var e=this;clearTimeout(e._sendHeartbeatsTimer)};f.prototype.startReading=function(){var e=this,t=e.ws,r;function n(i){if(r=typeof i.data==\"string\"?ae.parseMsg(i.data):le.parseMsg(g(i.data)),r.t===l.MsgTypeProtocolError){var a=r.size;a===l.ErrorAbnormal?t[M]=K:a===l.ErrorUnsupported?t[M]=F:a===l.ErrorTimeout?t[M]=X:t[M]=W,t.close(4e3+a)}else r.size!==0&&r.t!==l.MsgTypeHeartbeat?t.onmessage=o:(e.handleMsg(r),r=null)}function o(i){var a=i.data;t.onmessage=n,e.handleMsg(r,typeof a==\"string\"?a:g(a)),r=null}function s(i){var a=typeof i.data==\"string\"?ae.parseVersion(i.data):le.parseVersion(g(i.data));a!==l.Version?(t[M]=F,e.closeError(l.ErrorUnsupported)):(t.onmessage=n,e.heartbeatInterval>0&&e.startSendingHeartbeats())}t.onmessage=s,t._bufferedMessages&&(t._bufferedMessages.forEach(function(i){t.onmessage({data:i})}),t._bufferedMessages=null)};var E={};f.prototype.handleMsg=function(e,t){var r=this,n=E[e.t];n?n.call(r,e,t):(r.ws&&(r.ws[M]=W),r.closeError(l.ErrorInvalidMsg))};E[l.MsgTypeSingleReq]=function(e,t){var r=this,n,o;if(n=r.handlers.findRequestHandler(e.name),o=function(s){r.sendMsg(l.MsgTypeSingleRes,e.id,null,0,s)},o.error=function(s){var i=s.message||String(s);r.sendMsg(l.MsgTypeErrorRes,e.id,null,0,i)},typeof n!=\"function\")o.error('no such operation \"'+e.name+'\"');else try{n(t,o,e.name)}catch(s){L(\"[gotalk] handler error:\",s.stack||\"\"+s),o.error(\"internal error\")}};function Q(e,t){var r=e.id;typeof r!=\"string\"&&(r=String.fromCharCode.apply(null,r));var n=this,o=n.pendingRes[r];if((e.t!==l.MsgTypeStreamRes||!t||(t.length||t.size)===0)&&(delete n.pendingRes[r],n.pendingClose&&!n.hasPendingRes&&n.end()),typeof o!=\"function\")return;e.t===l.MsgTypeErrorRes?(typeof t!=\"string\"&&(t=H.decode(t)),o(new Error(t),null)):o(null,t)}E[l.MsgTypeSingleRes]=Q;E[l.MsgTypeStreamRes]=Q;E[l.MsgTypeErrorRes]=Q;E[l.MsgTypeNotification]=function(e,t){var r=this.handlers.findNotificationHandler(e.name);r&&r(t,e.name)};E[l.MsgTypeHeartbeat]=function(e){this.emit(\"heartbeat\",{time:new Date(e.size*1e3),load:e.wait})};f.prototype.sendMsg=function(e,t,r,n,o){var s=o&&typeof o==\"string\"&&this.protocol===l.binary?H.sizeOf(o):o?o.length||o.size:0,i=this,a=i.protocol.makeMsg(e,t,r,n,s);try{i.ws.send(a),s!==0&&i.ws.send(o)}catch(m){throw(!this.ws||this.ws.readyState>WebSocket.OPEN)&&(m=new Error(\"socket is closed\")),m}};f.prototype.closeError=function(e){var t=this,r;if(t.ws){try{t.ws.send(t.protocol.makeMsg(l.MsgTypeProtocolError,null,null,0,e))}catch(n){}t.ws.close(4e3+e)}};var ue=\"0000\";f.prototype.bufferRequest=function(e,t,r){var n=this,o=n.nextOpID++;n.nextOpID===1679616&&(n.nextOpID=0),o=o.toString(36),o=ue.substr(0,4-o.length)+o,n.pendingRes[o]=r;try{n.sendMsg(l.MsgTypeSingleReq,o,e,0,t)}catch(s){delete n.pendingRes[o],r(s)}};f.prototype.bufferNotify=function(e,t){this.sendMsg(l.MsgTypeNotification,null,e,0,t)};f.prototype.request=function(e,t,r){var n;return r?n=JSON.stringify(t):r=t,this.bufferRequest(e,n,function(o,s){var i=J(s);return r(o,i)})};f.prototype.notify=function(e,t){var r=JSON.stringify(t);return this.bufferNotify(e,r)};f.prototype.requestp=function(e,t){var r=this;return new Promise(function(n,o){r.request(e,t,function(s,i){s?o(s):n(i)})})};f.prototype.bufferRequestp=function(e,t){var r=this;return new Promise(function(n,o){r.bufferRequest(e,t,function(s,i){s?o(s):n(i)})})};var O=function(e,t,r){return Object.create(O.prototype,{s:{value:e},op:{value:t,enumerable:!0},id:{value:r,enumerable:!0}})};p.mixin(O.prototype);O.prototype.write=function(e){this.ended||(this.started?this.s.sendMsg(l.MsgTypeStreamReqPart,this.id,null,0,e):(this.started=!0,this.s.sendMsg(l.MsgTypeStreamReq,this.id,this.op,0,e)),(!e||e.length===0||e.size===0)&&(this.ended=!0))};O.prototype.end=function(){this.write(null)};f.prototype.streamRequest=function(e){var t=this,r=t.nextStreamID++;t.nextStreamID===46656&&(t.nextStreamID=0),r=r.toString(36),r=\"!\"+ue.substr(0,3-r.length)+r;var n=O(t,e,r);return t.pendingRes[r]=function(o,s){o?n.emit(\"end\",o):!s||s.length===0?n.emit(\"end\",null):n.emit(\"data\",s)},n};function b(){return Object.create(b.prototype,{reqHandlers:{value:{}},reqFallbackHandler:{value:null,writable:!0},noteHandlers:{value:{}},noteFallbackHandler:{value:null,writable:!0}})}v.Handlers=b;b.prototype.handleBufferRequest=function(e,t){e?this.reqHandlers[e]=t:this.reqFallbackHandler=t};b.prototype.handleRequest=function(e,t){return this.handleBufferRequest(e,function(r,n,o){var s=function(a){return n(JSON.stringify(a))};s.error=n.error;var i=J(r);t(i,s,o)})};b.prototype.handleBufferNotification=function(e,t){e?this.noteHandlers[e]=t:this.noteFallbackHandler=t};b.prototype.handleNotification=function(e,t){this.handleBufferNotification(e,function(r,n){t(J(r),n)})};b.prototype.findRequestHandler=function(e){var t=this.reqHandlers[e];return t||this.reqFallbackHandler};b.prototype.findNotificationHandler=function(e){var t=this.noteHandlers[e];return t||this.noteFallbackHandler};var de=!1;function Se(e,t,r){var n;try{n=new WebSocket(t),n.binaryType=\"arraybuffer\",n.onclose=function(o){u.developmentMode&&!de&&fe==u.defaultResponderAddress&&(de=!0,L(\"gotalk connection failed with code \"+G(o.code)+\". If you are serving gotalk.js yourself, remember to set gotalk.defaultResponderAddress to the gotalk websocket endpoint.\"));var s=new Error(\"connection failed: \"+G(o.code));r&&r(s)},n.onopen=function(o){n.onerror=void 0,e.adoptWebSocket(n),e.handshake(),r&&r(null,e),e.emit(\"open\"),e.startReading()},n.onmessage=function(o){n._bufferedMessages||(n._bufferedMessages=[]),n._bufferedMessages.push(o.data)}}catch(o){L(\"[gotalk] WebSocket init error:\",o.stack||\"\"+o),r&&r(o),e.emit(\"close\",o)}}function ke(e){e||(e=u.defaultResponderAddress);var t=e.substr(0,4);if(t!=\"ws:/\"&&t!=\"wss:\"&&(c.proto&&(e[0]==\"/\"?e[1]==\"/\"?e=c.wsproto+e:e=c.wsproto+c.host+e:e=c.wsproto+c.host+\"/\"+e)),!e)throw new Error(\"address not specified\");return e}f.prototype.open=function(e,t){var r=this;return!t&&typeof e==\"function\"&&(t=e,e=null),Se(r,ke(e),t),r};u.open=function(e,t,r,n){return f(r||u.defaultHandlers,n).open(e,t)};f.prototype.openKeepAlive=function(e){var t=this;return t.keepalive&&t.keepalive.disable(),t.keepalive=se(t,e),t.keepalive.enable(),t};u.connection=function(e,t,r){return f(t||u.defaultHandlers,r).openKeepAlive(e)};u.defaultHandlers=b();u.handleBufferRequest=function(e,t){return u.defaultHandlers.handleBufferRequest(e,t)};u.handle=function(e,t){return u.defaultHandlers.handleRequest(e,t)};u.handleBufferNotification=function(e,t){return u.defaultHandlers.handleBufferNotification(e,t)};u.handleNotification=function(e,t){return u.defaultHandlers.handleNotification(e,t)};xe()});const Le=w(P());var g=function(){return typeof Uint8Array==\"undefined\"?null:function(t){return t instanceof Uint8Array?t:new Uint8Array(t instanceof ArrayBuffer?t:new ArrayBuffer(t))}}();function p(){}p.prototype.addListener=function(e,t){if(typeof t!=\"function\")throw TypeError(\"listener must be a function\");if(!this.__events)return Object.defineProperty(this,\"__events\",{value:{},enumerable:!1,writable:!0}),this.__events[e]=[t],this;var r=this.__events[e];return r===void 0?(this.__events[e]=[t],this):(r.push(t),this)};p.prototype.on=p.prototype.addListener;p.prototype.once=function(e,t){var r=!1,n=function(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))};return this.on(e,n)};p.prototype.removeListener=function(e,t){var r,n=this.__events?this.__events[e]:void 0;if(n!==void 0){for(;(r=n.indexOf(t))!==-1;)n.splice(r,1);return n.length===0&&delete this.__events[e],n.length}return this};p.prototype.removeAllListeners=function(e){this.__events&&(e?delete this.__events[e]:delete this.__events)};p.prototype.listeners=function(e){return e?this.__events?this.__events[e]:void 0:this.__events};p.prototype.emit=function(e){var t=this.__events?this.__events[e]:void 0;if(t===void 0)return!1;for(var r=0,n=t.length,o=Array.prototype.slice.call(arguments,1);r!==n;++r)t[r].apply(this,o);return!0};p.mixin=function(t){for(var r=t;r;){if(r.__proto__===Object.prototype)return r.__proto__=p.prototype,t;r=r.__proto__}return t};const h=w(V()),pe=w(j());var y={available:!1,onLine:!0};h.global.addEventListener&&(y.available=!0,y.onLine=typeof navigator!=\"undefined\"?navigator.onLine:!0,h.global.addEventListener(\"offline\",function(e){y.onLine=!1,y.emit(\"offline\")}),h.global.addEventListener(\"online\",function(e){y.onLine=!0,y.emit(\"online\")}));function se(e,t,r,n){r?r<100&&(r=100):r=500,(!n||n<r)&&(n=5e3);var o,s,i,a=0,m,Y;return o={isEnabled:!1,isConnected:!1,enable:function(){o.enabled||(o.enabled=!0,a=0,o.isConnected||s())},disable:function(){o.enabled&&(clearTimeout(m),o.enabled=!1,a=0)}},s=function(){clearTimeout(m),e.open(t,function(S){Y=new Date,S?i(S):(a=0,o.isConnected=!0,e.once(\"close\",i))})},i=function(S){if(clearTimeout(m),o.isConnected=!1,!o.enabled)return;if(y.available&&!y.onLine&&!(h.document&&h.document.location&&h.document.location.hostname!==\"localhost\"&&h.document.location.hostname!==\"127.0.0.1\"&&h.document.location.hostname!==\"[::1]\")){y.once(\"online\",i),a=0;return}S?S.isGotalkProtocolError?S.code===pe.ErrorTimeout?a=0:a=n:a=a?Math.min(n,a*2):r:a=Math.max(100,r-(new Date-Y)),m=setTimeout(s,a)},o}return ce();})();\n"
